{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport axios from 'axios';\nvar globalData = null;\nvar globalPage = 0;\nlet nextPageNum = 1;\nlet limitPageNum = 1;\nexport default function MainPagingListModel() {\n  _s();\n\n  // console.log(listData);\n  // 추가 데이터를 로드하는지 아닌지를 담기위한 state\n  const [fetching, setFetching] = useState(false); // 리스트 데이터 저장\n\n  const [jsonData, jsonDataSet] = useState([]); // 다음 페이지 데이터를 저장\n  // const [getPaging, setPaging] = useState<IPagingData>({ next: undefined });\n  // 메인 리스트 취득\n\n  const mainFetchData = async () => {\n    try {\n      const response = await axios.get('https://cocoa.akibatv.net/?/api/blog_playneko_main?page=' + globalPage + '&limitpage=' + limitPageNum);\n\n      if (response.data != null) {\n        console.log(response.data.list);\n        globalData = response.data.list;\n        globalPage = globalData.length + nextPageNum;\n        jsonDataSet(response.data.list);\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  }; // 추가 리스트 취득\n\n\n  const moreFetchData = async () => {\n    // 추가 데이터를 로드하는 상태로 전환\n    setFetching(true);\n\n    try {\n      console.log(globalPage);\n      const response = await axios.get('https://cocoa.akibatv.net/?/api/blog_playneko_main?page=' + globalPage + '&limitpage=' + limitPageNum);\n\n      if (response.data != null) {\n        // 추가 데이터 부분\n        const fetchedData = response.data.list; // 기존 데이터 배열과 새로 받아온 데이터 배열을 합쳐 새 배열을 만들고 state에 저장한다. \n\n        const mergedData = globalData.concat(...fetchedData);\n        globalData = mergedData;\n        globalPage = fetchedData.length + nextPageNum;\n        console.log(mergedData);\n        jsonDataSet(mergedData);\n      }\n    } catch (e) {\n      console.log(e);\n    } // 추가 데이터 로드 끝\n\n\n    setFetching(false);\n  }; // 스크롤 이벤트 핸들러\n\n\n  const handleScroll = () => {\n    const scrollHeight = document.documentElement.scrollHeight;\n    const scrollTop = document.documentElement.scrollTop;\n    const clientHeight = document.documentElement.clientHeight;\n\n    if (scrollTop + clientHeight >= scrollHeight && fetching === false) {\n      // 페이지 끝에 도달하면 추가 데이터를 받아온다\n      moreFetchData();\n    }\n  };\n\n  useEffect(() => {\n    // 메인 리스트 가져오기\n    mainFetchData(); // scroll event listener 등록\n\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => {\n      // scroll event listener 해제\n      window.removeEventListener(\"scroll\", handleScroll);\n    };\n  }, []);\n  return jsonData;\n}\n\n_s(MainPagingListModel, \"LlLPxeVXTXyC8RiOHP6Wpyv42lc=\");\n\n_c = MainPagingListModel;\n\nvar _c;\n\n$RefreshReg$(_c, \"MainPagingListModel\");","map":{"version":3,"sources":["/Volumes/BackupHDD/work/react/playneko-react/src/model/MainPagingListModel.js"],"names":["useState","useEffect","axios","globalData","globalPage","nextPageNum","limitPageNum","MainPagingListModel","fetching","setFetching","jsonData","jsonDataSet","mainFetchData","response","get","data","console","log","list","length","e","moreFetchData","fetchedData","mergedData","concat","handleScroll","scrollHeight","document","documentElement","scrollTop","clientHeight","window","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport axios from 'axios'\n\nvar globalData = null;\nvar globalPage = 0;\nlet nextPageNum = 1;\nlet limitPageNum = 1;\n\nexport default function MainPagingListModel() {\n    // console.log(listData);\n    // 추가 데이터를 로드하는지 아닌지를 담기위한 state\n    const [fetching, setFetching] = useState(false);\n    // 리스트 데이터 저장\n    const [jsonData, jsonDataSet] = useState([]);\n    // 다음 페이지 데이터를 저장\n    // const [getPaging, setPaging] = useState<IPagingData>({ next: undefined });\n\n    // 메인 리스트 취득\n    const mainFetchData = async () => {\n        try {\n            const response = await axios.get('https://cocoa.akibatv.net/?/api/blog_playneko_main?page=' + globalPage + '&limitpage=' + limitPageNum);\n            if (response.data != null) {\n                console.log(response.data.list);\n                globalData = response.data.list;\n                globalPage = globalData.length + nextPageNum;\n                jsonDataSet(response.data.list);\n            }\n        } catch(e) {\n            console.log(e);\n        }\n    }\n\n    // 추가 리스트 취득\n    const moreFetchData = async () => {\n        // 추가 데이터를 로드하는 상태로 전환\n        setFetching(true);\n\n        try {\n            console.log(globalPage);\n            const response = await axios.get('https://cocoa.akibatv.net/?/api/blog_playneko_main?page=' + globalPage + '&limitpage=' + limitPageNum);\n            if (response.data != null) {\n                // 추가 데이터 부분\n                const fetchedData = response.data.list;\n                // 기존 데이터 배열과 새로 받아온 데이터 배열을 합쳐 새 배열을 만들고 state에 저장한다. \n                const mergedData = globalData.concat(...fetchedData);\n                globalData = mergedData;\n                globalPage = fetchedData.length + nextPageNum;\n                console.log(mergedData);\n                jsonDataSet(mergedData);\n            }\n        } catch(e) {\n            console.log(e);\n        }\n\n        // 추가 데이터 로드 끝\n        setFetching(false);\n    }\n\n    // 스크롤 이벤트 핸들러\n    const handleScroll = () => {\n        const scrollHeight = document.documentElement.scrollHeight;\n        const scrollTop = document.documentElement.scrollTop;\n        const clientHeight = document.documentElement.clientHeight;\n        if (scrollTop + clientHeight >= scrollHeight && fetching === false) {\n            // 페이지 끝에 도달하면 추가 데이터를 받아온다\n            moreFetchData();\n        }\n    };\n\n    useEffect(() => {\n        // 메인 리스트 가져오기\n        mainFetchData();\n        // scroll event listener 등록\n        window.addEventListener(\"scroll\", handleScroll);\n        return () => {\n            // scroll event listener 해제\n            window.removeEventListener(\"scroll\", handleScroll);\n        };\n    }, []);\n\n    return jsonData;\n}\n"]},"metadata":{},"sourceType":"module"}